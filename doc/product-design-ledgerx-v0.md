# LedgerX

**Personal Finance Ledger (Image-based Import)**

LedgerX 是一个面向个人的记账与资金分析系统，  
支持用户为不同类型的“卡（账户）”导入交易截图，  
通过图片识别与规则解析，自动生成账本，并进行消费 / 收入分析。

---

## LedgerX 是做什么的？

LedgerX 解决的是下面这个现实问题：

> **我有多张“卡”（银行卡、PayPay、信用卡等），  
>  每张卡都有自己的交易记录，但这些记录彼此割裂，  
>  而且账户之间经常互相转账，导致记账和统计非常混乱。**

LedgerX 的做法是：

- 把 **银行卡 / PayPay / 信用卡 / 股票账户**  
  统一抽象为“卡（Account）”
- 每张卡都支持 **图片导入交易记录**
- 系统识别交易后，由用户确认
- 自动区分：
    - 消费
    - 收入
    - 账户之间的转账
- 在此基础上，生成**干净、可解释的消费与收入分析**

---

## 核心功能（v0）

### 1. 卡（Account）管理
用户需要先创建“卡”，再进行导入。

一张“卡”可以是：
- 银行卡
- PayPay 等电子钱包
- 信用卡
- 股票账户（v0 暂不支持自动导入）

每张卡都有明确的类型，用于后续解析规则。

---

### 2. 图片导入交易记录

LedgerX **不依赖银行或支付平台 API**，  
而是基于用户已有的数据：**交易截图**。

导入流程：
1. 选择卡（必选）
2. 上传交易截图（支持多张）
3. 系统进行图片识别（OCR）
4. 根据卡类型解析出交易候选
5. 用户确认后写入账本

---

### 3. 导入确认（关键步骤）

所有图片导入的交易，都会先进入**确认页面**：

用户可以：
- 确认 / 忽略某条交易
- 修改金额、日期、描述
- 标记为“转账”（账户之间资金移动）

只有确认后的交易，才会进入正式账本。

---

### 4. 自动识别账户转账

LedgerX 会自动尝试识别以下场景：
- 银行卡 → PayPay（充值）
- PayPay → 银行卡（出金）
- 银行卡 ↔ 银行卡

识别规则包括：
- 金额相同或接近
- 方向相反（一进一出）
- 时间接近

被识别为转账的记录：
- **不会计入消费或收入**
- 只作为账户之间的资金流动

---

### 5. 消费 / 收入分析

在账本数据基础上，LedgerX 提供基础分析能力：

#### 消费分析
- 主要统计：
    - PayPay
    - 信用卡
- 只统计真实消费
- 自动排除转账

#### 收入分析
- 主要统计银行卡收入
- 排除账户之间转账

---

## 核心数据模型（简化）

LedgerX v0 使用三个核心概念：

- **Account（卡）**  
  表示一个资金账户（银行卡 / PayPay / 信用卡）

- **Transaction（交易）**  
  一笔真实发生的资金记录（收入或支出）

- **Transfer（转账）**  
  两笔交易之间的“账户间转账”关系

### 简化领域模型图

```mermaid
classDiagram
    direction LR

    class Account {
        id
        name
        type
    }

    class Transaction {
        id
        accountId
        occurredAt
        amount
        direction
        linkedTransferId
    }

    class Transfer {
        id
        fromAccountId
        toAccountId
        amount
    }

    Account "1" --> "0..*" Transaction
    Transfer "1" --> "2" Transaction
